name: ingest_affiliates

on:
  schedule:
    - cron: "0 * * * *"   # roda todo início de hora
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - run: python -m pip install --upgrade pip && pip install requests python-slugify
      - name: Run importer
        env:
          WC_SITE: ${{ secrets.WC_SITE }}         # ex: https://ctctech.store
          WC_CK:   ${{ secrets.WC_CK }}
          WC_CS:   ${{ secrets.WC_CS }}

          # Opcional: chaves de afiliadas. Preencha as que tiver.
          AMZ_ACCESS_KEY: ${{ secrets.AMZ_ACCESS_KEY }}
          AMZ_SECRET_KEY: ${{ secrets.AMZ_SECRET_KEY }}
          AMZ_PARTNER_TAG: ${{ secrets.AMZ_PARTNER_TAG }}

          MELI_APP_ID:    ${{ secrets.MELI_APP_ID }}
          MELI_SECRET:    ${{ secrets.MELI_SECRET }}
          MELI_TOKEN:     ${{ secrets.MELI_TOKEN }}

          SHOPEE_PARTNER_ID:  ${{ secrets.SHOPEE_PARTNER_ID }}
          SHOPEE_PARTNER_KEY: ${{ secrets.SHOPEE_PARTNER_KEY }}
          SHOPEE_SHOP_ID:     ${{ secrets.SHOPEE_SHOP_ID }}

          ALX_APP_KEY:    ${{ secrets.ALX_APP_KEY }}
          ALX_APP_SECRET: ${{ secrets.ALX_APP_SECRET }}

          # Feeds CSV adicionais por loja (se quiser): lista separada por vírgula
          CSV_FEEDS: ${{ secrets.CSV_FEEDS }}
        run: |
          python scripts/ingest.py
